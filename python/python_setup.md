> **Python** - интерпретируемый язык с сильной динамической типизацией.

> **CPython** - интерпретатор python (среда выполнения); написан на C.

`python3 --version` - Установленная версия.

`.py` - расширение python-файлов.

```
// запуск кода в файле

python3 file.py
```

**Pytest** - фреймворк для написания тестов.

## Работа с REPL

> Python идёт со встроенным REPL, работает как shell интерпретатор python.

`python3` - запуск REPL.

`help()` - справка в интерактивном режиме.  
- `quit/CTRL+D` - выход  
- `topics` - полезные топики  
- `f/b` - навигация  
- `:q`

**Docstring** - документирование кода, доступно потом в help().

```
// пример документирования кода

def add(a, b):
  """Add a to b function"""
  return a + b

>>> help(add)  // выведет "Add a to b function"
```

`len("string")` - длина строки.

`>>>` - приглашение REPL.

`pepr()` - выведет аргументы в каноническом представлении.

`import` - подключение встроенных модулей в REPL.

```
import operator
from math import sqrt

operator.pow(2, 2)
sqrt()
```

`_` - оператор; хранит результат выполнения предыдущей команды.

___

## Пакеты и индекс

> **Пакет** - единица обмена кодом между разработчиками.

> Python-пакет содержит исходный код и метаданные (описание, версии, совместимость с python, лицензия, зависимости).

> **Индекс** - репозиторий пакетов (обычно веб-сайт).

**PyPI** - python package index; самый популярный индекс;  
`pypi.org`  
`test.pypi.org` - тестовый индекс для обучения.

___

## Distutils, Setuptools, pip

**distutils** - для создания дистрибутивов.

> Каждый пакет содержит `setup.py`, к котором импортирована функция `setup`  из модуля distutils.

**Setyptools** - более удобная надстройка над distutils.

**Poetry** - более простой инструмент для создания пакетов, загрузки в индекс.

```
// установить пакет

python3 setup.py install
```

**pip** - python package installer; для скачивания и установки пакетов.

```
// установить в user окружение

python3 -m pip install --user cowsay
```

## Pip install

**Установка pip**
```
sudo apt update
sudo apt install python3-pip
```

> Pip использует pypi индекс по дефолту.

`python3 -m` - запуск модуля.

`python3 -m pip help` - справка.

**Команды pip:**
- `--version`
- `help`
- `install`:
  - `--user` - установка в user окружение
  - `--upgrade <package>` - обновление версии пакета (можно и сам pip)
  - `--index-url <url>` - адрес альтернативного индекса (pypi по дефолту)
  - `--extra-index-url <url>` - адрес дополнительного индекса, если в `--index-url` не нашёл
- `list` - список установленных пакетов

```
// обновить pip, если есть версия свежее

python3 -m pip install --user --upgrade pip
```

```
// установка пакета из другого индекса

python3 -m pip install --user --index-url https://...
```

```
// установка пакета из GitHub

python3 -m pip install --user git+https://some-repo.git   // url который используется при git clone
```

___

## Виртуальное окружение

> Это механизм позволяющий запускать разные проекты в своём независимом окружении.  
> По сути это директория с файловой структурой схожей с общесистемным окружением.

**venv** - модуль виртуального окружения.

`sudo apt install python3-venv`

```
// создать виртуальное окружение

python3 -m venv <venv_name>
```

```
// установка пакета виртуальном окружении

my_venv/bin/pip install cowsay

// запуск пакета тоже из /bin

my_env/bin/cowsay hi
```

### Активация окружения

> Чтобы не писать my_env/bin/... нужно сделать **активацию:**  
> `source my_env/bin/activate`  
> Теперь приглашение будет `(my_venv):~$`

`deactivate` - команда деактивации.

> Можно активировать несколько окружений в отдельных терминалах.

> Директория виртуального окружения находится в директории юзера;  
> содержит `/bin` с копией интерпретатора python3 и копия бинарника pip.

> В директории `lib/python3.10/site-packages`  лежит библиотеки установленные в окружение, по дефолту это  
> pip и Setuptools.

**pipx** - install and run python app in isolated virtual environment.

___

## Scripts

**Скрипт** - (сценарий) программа на интерпретируемом яп.

**Скриптовый яп** - на котором удобно писать скрипты.

**Shebang** - (# - sharp, ! - bang); первая строка в файле скрипта, указывает интерпретатор.

`#!/usr/bin/python3` - шебанг указывает python интерпретатор.

> У файла со скриптом должны быть права на исполнение.

```
chmod +x script.py    //  добавить права на исполнение

./script.py           // запуск без указания интерпретатора
```

> Правильно указывать в шебанге через env переменную.

```
// указать путь до /env, само найдёт интерпретатор python3

#!/usr/bin/env python3
```

## Запускаемые модули и пакеты

`__name__` - специальная переменная, имеет 2 значения:  
1. если обычный импорт, то имя модуля  
2. если запущен как скрипт, то `__main__`

> По __name__ можно отличить запуск как скрипта от импортирования.

```
if __name__ == '__main__':
  // код запущен как скрипт
```

`main` - обычно глобальная функция (top-level environment), запускаемая при старте программы.  

```
// обычно пишется в конце модуля скрипта

if __name__ == '__main__':
  main()  // тут определить всё что надо выполнить при старте как скрипта
```

`__main__.py` - есть в каждом python пакете.

## Poetry

`pyproject.toml` - конфиг проекта.

`poetry.lock` - лок-файл; жёстко фиксирует версии пакетов для проекта.

`poetry install` - инициализация виртуального окружения; создает лок-файл; устанавливает все зависимости в `.venv`.

`poetry shell` - активировать окружение; `exit` - деактивировать.

`poetry new proj_name` - создать новый проект.

`poetry run` - запуск программы внутри окружения без активации.

`poetry add <package>` - добавить в проект; добавит зависимость в pyproject.toml.

`poetry remove <package>` - удаление пакета; также из pyproject.toml.

**Группы зависимостей** - эти зависимости учитываются при создании виртуального окружения, но не попадут в   
основные зависимости (типа dev decencies).

```
// добавить в dev зависимости
// tool.poetry.group.dev.dependencies

poetry add --group dev <package>
```

`poetry remove --group dev <package>` - удалить dev зависимость.

`poetry update` - обновление всех зависимостей; если указать имя, то для конкретного пакета.

> Версии транзитивных зависимостей никак не фиксируются.

`&&` - выполнить несколько poetry команд.

`poetry config virtualenvs.in-project true` - хранить виртуальное окружение внутри проекта в `.venv`.

### Создание poetry скрипта

`/scripts` - обычное место для скриптов.

```
// в pyproject.toml добавить:

[tool.poetry.scripts]
say-hi = "some_proj.scripts.say_hi:main"    // main - имя функции
```

```
// теперь можно запустить скрипт короткой командой

poetry run say-hi

// вместо

poetry run python -m some_proj.scripts.say_hi
```

### Сборка и установка

`poetry build` - сборка проекта в `/dist`.

`file.whl` - wheel; установочный файл; запускается с pip.

`python3 -m pip install .` - запуск проекта из текущей директории без создания дистрибутива.

___

## Linting

**flake8** - популярный линтер.

`poetry add --group=dev flake8` - установка.

`setup.cfg` - файл конфига для настройки правил и ограничений; создать самому.

`poetry run flake8 .` - запуск линтера для текущей директории.

___


