> **Git** - система контроля версий.

```git init``` - инициализирует репозиторий в текущей директории; создаёт директорию .git, которая содержит всё для контроля версий в рабочей директории

```git --version``` - текущая версия установленного git

___
## Глобальный/локальный конфиг

```git config --list``` - посмотреть текущий конфиг

```git config --global user.name <name>``` - установить имя пользователя; если не указать name, выведет текущее значение

```git config --global user.email <email>``` - установить/посмотреть email

```git config --global color.ui <auto>``` - установить цветовую схему

`git config --local` - локальные настройки, доступны в каждом конкретном репозитории.

___

```git status``` - статус репозитория  
  - ```-s/--short```

___

> **2 шага добавления новых файлов в репозиторий**:
>   - add - добавление в индекс отслеживания
>   - commit - фиксирование изменений


> Отслеживание изменений с помощью хеш-сумм; алгоритм SHA-1 (40 шестнадцатиричных символов).

> **3 состояние файла в git:**
>   - modified - изменен
>   - staged - индексирован
>   - commited - зафиксирован


> **3 секции git проекта:**
>   - working tree - рабочая копия
>   - staging area - индекс
>   - git directory - по сути сам репозиторий


`git clone <ssh/https link>` - clone remote repo.


`git pull` - получить изменения из remote repo


`git diff` - покажет изменения (не добавленные в индекс)
  - `--staged` - изменения добавленные в индекс

## Working directory

> **.git** - директория, которая по сути и есть репозиторий.

> **working directory** - это все файлы проекта, кроме /.git, эти файлы извлекаются из /.git в момент клонирования.

> Git сравнивает изменения в working directory с файлами в /.git (т.е. состояние на момент последнего коммита).

## Индекс

> **Индекс** - промежуточная область, хранит изменения файлов на пути от working dir -> remote repo.

> Пустые директории не индексируются.

`git add <file>` - добавить изменения в индекс.
  - `.` - все изменённый файлы
  - `-i` - интерактивный режим, позволяет разбить на куски изменения одного файла и выбрать что добавить в индекс

## Commit

> **commit** - (фиксация) окончательное добавление в репозиторий (git запомнит навсегда и будет отслеживать).  
> Это логически завершённое изменение внутри проекта, должен быть **атомарным** - выполнять одну задачу.

> **Цепочка коммитов** - по сути односвязный список, каждый последующий элемент базируется на предыдущем; последний элемент называется головой списка - HEAD.

`git commit` - создать commit; откроет дефолтный редактор для commit message.
  - `-m 'message'` - создать commit message без редактора
  - `-a` - тоже что git add .

```
// обычное добавление коммита
git commit -m 'message'

// добавит в индекс и создаст коммит для одного файла
git commit <file> -m 'message'

// добавит все изменения (кроме новых файлов) в индекс и создаст коммит
git commit -am 'message'
```

## История изменений

`git log` - список коммитов сортированных по дате
  - `-p` - diff для каждого коммита
  - `--oneline` - сокращённый вариант
  - `--name-status` - другой вариант вывода лога
  - `-- <file>` - коммиты файла
  - `--graph` - в виде графа

`git shortlog` - сокращённый лог из одних commit message.

`git show <hash>` - развёрнутый лог по одному коммиту, с diff.

**Навигация**:
  - `q` - quit
  - `f, space` - forward
  - `b` - backward
```
//показать коммиты, изменявшие todo.md

git log -p --oneline -- todo.md
```

`git show <hash>` - лог одного коммита с diff; можно указать короткий хеш 7 символов.

> **commit hash** - идентификатор коммита из 40/7 символов.

`git blame <file>` - коммиты одного файла

`git grep <string>` - ищет совпадение со строкой во всех файлах проекта (учитывает .gitignore, не ищет в .git).
  - `-i` - без учёта регистра
  - `<hash>` - если указать хеш, ищет в конкретном коммите

```
// список хешей коммитов где встречается synopsis
git grep synopsis $(git rev-list --all)
```

## Отмена изменений

> Откат не закоммиченных изменений безвозвратен!

`git clean` - удалить не индексированные изменения из рабочей директории.
  - `-f` - force
  - `-d` - directory
  - `-X` - remove gitignore files
  - `-n` - имитирует удаление, покажет что будет удалено

```
// удалить все не индексированные изменения
git clean -fd

// удалить node_modules
git clean -fdX

// посмотреть что будет удалено
git clean -d -n
```

`git restore <file>` - отмена изменений не индексированного файла.
  - `--staged` - отмена индексации файла
  - `.` - все файлы

## Отмена коммитов

> Git движется только вперёд, часто лучше поправить код в новом коммите.  
> ИЗменения истории коммитов опасно, могут возникнуть проблемы при синхронизации с remote repo.

`git clone` - всегда можно в крайнем случае

`git revert <hash>` - отменяет любой коммит; создаёт новый коммит с изменениями, противоположными отменяемому коммиту.
  - `--no-edit` - не откроет редактор commit message

`git reset` - удалить последний коммит/коммиты (не запушенные); по сути сдвигает указатель HEAD на один/несколько коммитов назад.
  - `--hard` - удалить изменения; без этого флага удалит коммит, но изменения останутся в working dir
  - `--no-commit`

```
// переместит HEAD на указанный коммит
git reset --hard <hash>

// удалить последний коммит; HEAD~ по дефолту == 1
git reset --hard HEAD~

// удалить 2 последних коммита
git reset --hard HEAD~2
```

> **HEAD** - последний сделанный коммит.

`git commit --amend` - добавляет новые застейдженные изменения в последний сделанный коммит; по сути делает git reset и новый коммит с добавленными в индекс изменениями.
  - `--no-edit` - без редактирования commit message

## Навигация по истории. Ветки

> **Ветка** - по сути это список коммитов.

`git switch <branch>` - переключиться на ветку; более подходящая команда для этого, чем git checkout.
  - `-c` - создать ветку от текущей и переключиться на неё

`git checkout <branch | hash>` - переключиться на указанную ветку/коммит.
  `-b` - создаст новую ветку от текущей и переключится на неё

`git branch` - покажет текущую ветку.


## Gitignore

`.gitignore` - список файлов/директорий, игнорируемых git; создавать в корне проекта.

```
// .gitignore

// игнор файла в любой директории проекта
access.log
node_modules/

// игнор директории в корне
/coverage/

// игнорить все файлы .sqlite3 в /db (но не во вложенных директориях)
/db/*.sqlite3

// игнорить все .txt файлы в /doc и во всех вложенных директориях
doc/**/*.txt
```

`git rm --cached <file>` - [doc](https://www.atlassian.com/ru/git/tutorials/undoing-changes/git-rm) удалить файл из списка отслеживаемых; команда противоположная git add; сам файл останется.


## Stash

> **stash** - хранилище внутри /.git, в которое можно спрятать изменения и восстановить при необходимости; например чтобы изменения не попали в коммит.

`git stash` - [doc](https://www.atlassian.com/ru/git/tutorials/saving-changes/git-stash) прячет все изменённые файлы (индексированные, отслеживаемые но не индексированные; не сохранит: новые файлы, игнорируемые).
  - `-u` - сохранит и неиндексированные новые файлы
  - `--all` - сохранит всё, в т.ч. игнорируемые

`git stash pop` - восстановить из stash

> Stash организован как **стек** (LIFO), каждый `git stash pop` извлекает последний сохранённый stash, удаляя его из списка.

`git stash list` - список всех stash

`git stash clear` - удалить всё в stash

`git stash apply stash@{n}` - восстановит изменения из конкретного стеша (n - в git stash list).

`git stash branch <name>` - создаст ветку и восстановит туда изменения.