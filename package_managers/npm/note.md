## npm ci

> Устанавливает зависимости из package-lock.json, а не из package.json.   
> Не обновляет package.json и package-lock.json.  
> Если lock-file нет, то вернёт ошибку.  
> Перед установкой полностью удаляет node_modules и создаёт заново.  
> Используется в ci-cd вместо npm install, для идентичности сборок в local/remote repo.  
> Для использования npm ci должен быть package.json.  
> Устанавливает только проект целиком, нельзя отдельные пакеты.  

> До этого такого эффекта достигали архивированием node_modules.

> npm ci намного быстрее npm i

> Если npm ci не доступен то: `npm install -g npm@latest`

___

## npm error ssl

`npm config set strict-ssl false`

`npm config list` - текущий конфиг.

___

## About packages

`npm ls` - показать дерево зависимостей проекта/конкретного пакета.
  - `<package_name>` - сабзависимости конкретного пакета
  - `--json`
  - `--depth=0` - только прямые зависимости

> **deduped** - дедупликация, т.е. npm обнаружил дубль зависимости и установил пакет только 1 раз.

> **npm проект** - любая директория с манифестом.

> **npm registry** - хранилище опубликованных пакетов.

> **package.json** - манифест проекта; содержит список зависимостей, скрипты и много доп. инфо.  
> Манифест создаётся либо вручную, либо `npm init`.

> **Транзитивные зависимости** - зависимости зависимостей; можно посмотреть в package-lock.json.

> **dependencies** - основной список зависимостей, без которых код не заработает.

> **devDependencies** - зависимости этапа разработки, не для рантайма (typescript, webpack, eslint, etc.).  
> В своём опубликованном пакете такие зависимости не будут устанавливаться при использовании пакета внешними пользователями.

> **peerDependencies** - используется для разработки публикуемых пакетов; помогает избежать дублей; не устанавливаются автоматически.  
> Например если публикуемый пакет требует react, и приложение использующее этот пакет тоже требует react, тогда react в опубликованном пакете должен быть в peerDependencies. Иначе две установки react приведут к ошибке.

> **optionalDependencies** - некритичные зависимости; если npm не смог установить, то игнорирует без ошибки.

> **Инициализатор** - специальный npm-пакет для инициализации конкретного приложения, генерирует нужный бойлерплейт.
```
// example
npm init react-app -- my-app
```

`npm i/install` - установка зависимости, свежая стабильная версия.
  - `-P/--save-prod` - установка в dependencies (default)
  - `-D/--save-dev` - установка в devDependencies
  - `-O/--save-optional` - в optionalDependencies
  - `--only=prod`
  - `--only=dev`

> В **peerDependencies** устанавливать вручную.

```
// установить конкретную версию
npm i lodash@3.9.2

// установить все зависимости из манифеста
npm i
```

`changelog.md` - лог изменений пакета.

`npm outdated` - выведет список устаревших прямых зависимостей.
  - `--depth=9999` - проверит все транзитивные зависимости

`npm update` - обновляет пакеты с учётом семвера, обновляет манифест.
  - `--depth=9999` - для всех транзитивных зависимостей

___

## Npm-check

> **npm-check** - инструмент проверки актуальности/используемости пакетов;  
> есть интерактивный режим выбора конкретных пакетов.

`npm i -g npm-check` - установка

`npm-check` - запуск проверки.
  - `-i` - интерактивный режим

___

`npm uninstall/rm/r/un` - удаление зависимости из проекта и манифеста.

```
// example
npm rm lodash express
```

`npm view @types/<package_name>` - поиск декларации типа в репозитории Definitely Typed.

___

## Lock file

`package-lock.json` - генерируется при npm install.

> Если lock-file есть в проекте, то npm install ставит зависимости в соответствии с ним, иначе возьмёт версии из манифеста.

> Lock-file обеспечивает стабильно одинаковые сборки, для этого его сохраняют в удалённом репозитории проекта.

> Для установки пакетов строго в соответствии с lock-file использовать `npm ci` вместо `npm i`.

> Lock генерируется автоматически на основе манифеста, состояния npm registry, алгоритма установки пакетов.  
> Поэтому файл не одинаковый в разное время.

> Lock-file не публикуется в registry.

___

## Npm-shrinkwrap

`npm-shrinkwrap.json` - тот же package-lock.json, но с другим именем и семантикой; в отличии от package-lock, публикуется в npm registry; фактически замораживает дерево зависимостей, даже если это опубликованный пакет.

> Имеет приоритет над package-lock. В проекте достаточно одного из них.

```
// создать файл
npm shrinkwrap
```
___

## Npm authorization

`npm whoami` - текущая авторизованная учётка.

`npm adduser` - авторизовать нового пользователя.

___

`npm rebuild` - ребилдит проект, например при обновлении версии ноды.

___

`npx` - утилита, позволяет установить библиотеку без инсталляции.
___


