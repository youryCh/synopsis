> **Http API** - способ взаимодействия между программами и сервисами по http протоколу.

**Базовые правила API:**  
- данные передаются в формате JSON  
- для каждого набора данных свой набор url

> **Endpoint** - url по которому получаем данные в api.

> **Динамический эндпоинт** - с меняющейся частью, вида `/users/{id}`.

> **Метаданные** - данные о данных.

> **Кеширование** - позволяет веб/прокси серверу сохранять ответ сервера и использовать его без повторного обращения к серверу.

> Кешируются GET запросы, POST, PUT, DELETE - нет.

___

## Виды API

### REST

> **REST** - representational state transfer; архитектурный стиль построения api; придумал один из создателей HTTP;  
> использует возможности HTTP по максимуму (заголовки, коды ответов и тп.).

> Есть попытки создать стандартизированный REST API (который не является стандартом), например `json:api`.

**REST API. Best Practices:**

1. Эндпоинт должен быть существительным, не глаголом;  
`/getItems`, `/updateItems`  - плохо  
`/items` - хорошо; а операции (get, update) разделять методами  
2. Использовать множественное число  
`/items/{item_id}`  
3. Версионировать лучше в заголовках, а не в URI  
`host/v2/items` - плохо  
`GET /items`  
`"Accept": "application/v1"` - хорошо  
4. При отправки большого объёма данных использовать пагинацию.

### RPC

> **RPC** - remote procedure call; самый ранний стиль описания апи.

> Обычно RPC API работает с одним эндпоинтом (например /rpc), на который отправляется GET/POST запрос.  
> Обработка ошибок, сайд-эффекты зашиты в само тело запроса/ответа.

> **Идея RPC** - мы вызывает функцию, остальное делается внутри неё неявно.

Некоторые стандарты RPC API:  
- NFC  
- XML-RPC  
- SOAP  
- JSON-RPC  
- gRPC  
- GraphQL  

```
// пример запроса к JSON-RPC
curl -X POST \
  -H 'Content-Type: application/json' \
  -d '{"jsonrpc":"2.0","id":1,"method":"greet","params":{"name":"Anna"}}' \
  http://localhost:8080/rpc
```

### REST-full

**5 principles:**  
1. Everything is a resource
2. Every resource is identified by a uniq id
3. Use simple and uniform interfaces
4. Communication are done by representation
5. Be stateless

> REST-full - если соблюдены все 5 требований.  
> REST-like - если не все.

___

## Open API

> **Open API** - языконезависимый стандарт описания апи, понятный человеку и машине.

Позволяет делать:  
- авто генерацию документации  
- авто генерацию тестов  
- авто генерацию кода запроса  
- проверку корректности данных

> Удобно записывать в yaml или json формате.

___

## HTTP methods

> **Безопасный метод** - который не изменяет состояние данных.

| HTTP method | Safe | Idempotent |
|-------------|------|------------|
| GET         | +    | +          |
| POST        | -    | -          |
| PUT         | -    | +          |
| PATCH       |      | -          |
| DELETE      | -    | +          |
| OPTIONS     | +    | +          |
| HEADS       | +    | +          |

> **GET** - безопасный, идемпотентный, для получения данных ресурса.

> **POST** - для создания новых ресурсов.

> **PUT** - для обновления ресурсов, идемпотентный, поэтому больше подходит для обновления чем POST.

> **OPTIONS** - не используется для манипуляции ресурсом; для получения информации о ресурсе;  
> используется браузером для preflight-запроса для сложных запросов.

> **HEAD** - для запроса ресурса, как и GET, но возвращает только заголовки с информацией о ресурсе, не сам ресурс;  
> позволяет узнать существует ли ресурс, размер ресурса, дату изменения/создания;  
> экономит время и трафик.

> **DELETE** - по спеке идемпотентный и при повторном запросе должен возвращать 204, но часто по ошибке обрабатывается  
> как не идемпотентный и повтор возвращает 404.

> **PATCH** - для частичного обновления ресурса; не идемпотентный, но часто его делают таким;  
> в ответ возвращается или 204, или 200 + тело с изменёнными данными.

___


